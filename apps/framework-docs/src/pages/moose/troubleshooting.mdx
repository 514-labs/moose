# Troubleshooting

Common issues and their solutions when working with Moose.

## Development Environment

### Issue: `moose dev` fails to start

**Possible causes and solutions:**

1. **Port conflicts**
   - Check if ports 4000-4002 are already in use
   - Solution: Kill the conflicting processes or configure different ports

   ```bash
   # Find processes using ports
   lsof -i :4000-4002
   
   # Kill process by PID
   kill <PID>
   
   # Or configure different ports in moose.config.toml
   [server]
   port = 5000
   ```

2. **Missing dependencies**
   - Solution: Ensure all dependencies are installed

   ```bash
   npm install
   ```

3. **Docker not running**
   - Solution: Start Docker Desktop or Docker daemon

   ```bash
   # Check Docker status
   docker info
   
   # Start Docker on Linux
   sudo systemctl start docker
   ```

### Issue: Hot reloading not working

1. **TypeScript compilation errors**
   - Solution: Check for errors in your code
   
   ```bash
   # Run TypeScript compiler
   npx tsc --noEmit
   ```

2. **Watcher limits on Linux**
   - Solution: Increase file watch limits
   
   ```bash
   echo fs.inotify.max_user_watches=524288 | sudo tee -a /etc/sysctl.conf
   sudo sysctl -p
   ```

## Data Ingestion

### Issue: Data not appearing in tables

1. **Validation errors**
   - Check logs for validation failures
   - Solution: Ensure data matches schema

   ```bash
   # View logs
   moose logs
   ```

2. **Stream processing errors**
   - Solution: Check transform functions for errors
   
   ```bash
   # View stream processing logs
   moose logs --service stream-processor
   ```

3. **Database connectivity**
   - Solution: Verify database connection
   
   ```bash
   # Check database status
   moose status
   ```

## Stream Processing

### Issue: High processing latency

1. **Insufficient parallelism**
   - Solution: Increase stream parallelism
   
   ```typescript
   const stream = new Stream<Data>("high_volume", {
     parallelism: 8  // Increase from default
   });
   ```

2. **Resource constraints**
   - Solution: Allocate more resources or optimize processing
   
   ```bash
   # Check resource usage
   moose status --resources
   ```

### Issue: Data transformations not working

1. **Transform function errors**
   - Solution: Debug transformation logic
   
   ```typescript
   // Add logging to transform
   stream.addTransform(outputStream, (record) => {
     console.log('Processing record:', record.id);
     try {
       // Your transformation logic
       return transformedRecord;
     } catch (error) {
       console.error('Transform error:', error);
       return undefined;  // Skip record on error
     }
   });
   ```

## Database Issues

### Issue: "Table not found" errors

1. **Table not created**
   - Solution: Verify table creation in code
   
   ```bash
   # List tables
   moose ls
   ```

2. **Schema sync issues**
   - Solution: Restart development server
   
   ```bash
   moose dev --reset
   ```

### Issue: Slow queries

1. **Missing or improper indexes**
   - Solution: Check orderByFields configuration
   
   ```typescript
   const table = new OlapTable<Data>("slow_table", {
     orderByFields: ["frequently_queried_field", "timestamp"]
   });
   ```

2. **Large result sets**
   - Solution: Add limits and pagination
   
   ```typescript
   // In query API
   const results = await db.query(`
     SELECT * FROM large_table
     WHERE category = 'example'
     LIMIT 100
   `);
   ```

## Deployment Issues

### Issue: Deployment fails

1. **Configuration errors**
   - Solution: Check deployment configuration
   
   ```bash
   # Validate configuration
   moose validate --config
   ```

2. **Resource limitations**
   - Solution: Increase resource allocation
   
   ```yaml
   # In kubernetes manifest
   resources:
     requests:
       memory: "1Gi"
       cpu: "500m"
     limits:
       memory: "2Gi"
       cpu: "1000m"
   ```

3. **Permission issues**
   - Solution: Verify service account permissions
   
   ```bash
   # Check permissions
   moose auth check
   ```

## Common Error Messages

| Error | Cause | Solution |
|-------|-------|----------|
| `Failed to start development server` | Environment setup issue | Check Docker, ports, dependencies |
| `Validation error: ... required` | Missing required fields | Verify data conforms to schema |
| `Stream processing error` | Transform function error | Debug transformation logic |
| `Table ... not found` | Table not created or synced | Check table definition and restart |
| `Connection refused` | Service not running | Verify all services are running |
| `Memory limit exceeded` | Resource constraints | Optimize code or increase resources |

## Getting Help

If you can't resolve an issue:

1. Check the [FAQ](./faqs) for common questions
2. Search existing [GitHub issues](https://github.com/514-labs/moose/issues)
3. Open a new issue with:
   - Moose version (`moose --version`)
   - Error messages and logs
   - Steps to reproduce
   - Expected vs. actual behavior 