import { Tabs, Steps, Card } from "nextra/components";
import { Callout, CTACard, CTACards } from "../components";
import { RectangleEllipsis, Square } from "lucide-react";
import { LanguageSwitcher } from "../components/language-switcher";

# Quick Start

<LanguageSwitcher />

<Callout type="info" title="Prerequisites:">
  <ul>
    <li>[Git](https://git-scm.com/)</li>
    <TypeScript>
      <li>[NodeJS](https://nodejs.org/en/)</li>
    </TypeScript>
    <Python>
      <li>[Python version 3.7+](https://www.python.org/downloads/)</li>
    </Python>
    <li>[Docker](https://www.docker.com/)</li>
    <li>
      macOS or Linux (Windows is not supported at this time, but may work using
      WSL Windows Subsystem for Linux){" "}
    </li>
  </ul>
</Callout>

Check if these dependencies are installed:

<TypeScript>
```bash filename="Terminal" copy 
git --version && node --version && docker --version
```
</TypeScript>

<Python>
```bash filename="Terminal" copy 
git --version && python3 --version && docker --version 
```
</Python>

## Initialize Moose Project

<Steps>
<Python>
### Create and Activate a Python Virtual Environment
Navigate to where you want to create your project and run the following command to create a new Python virtual environment:

```bash filename="Terminal" copy
python3 -m venv venv
```
<Callout type="info" title="Virtual Environment Best Practice">
  Create a new Python virtual environment for each project to avoid conflicts.
</Callout>
Activate the virtual environment by running the following command:
```bash filename="Terminal" copy
source venv/bin/activate
```

### Install the Moose CLI

Moose is installed as a Python package, so you can install it using pip:

```bash filename="Terminal" copy
pip install moose-cli
```

### Initialize a New Moose Project via the CLI

```bash filename="Terminal" copy
moose-cli init my-moose-app python
```

<Callout type="warning" title="Don't forget the python flag!">
  Don't forget to include the `python` flag when initializing your project.
</Callout>

</Python>

<TypeScript>
### Run `create-moose-app` in your terminal 

```bash filename="Terminal" copy
npx create-moose-app@latest my-moose-app ts 
```
</TypeScript>

This will automatically create a new project folder and initialize a skeleton Moose app with the entire project structure you need to get started.

<TypeScript>
### Navigate to your Project Directory and Install Project Dependencies

```bash filename="Terminal" copy
cd my-moose-app && npm install
```

</TypeScript>

### Start Local Dev Server

<Callout type="warning" title="Make sure Docker is running.">
  Run `docker info` to check.
</Callout>

<TypeScript>

```bash filename="Terminal" copy
npx moose-cli dev
```

</TypeScript>
<Python>
```bash filename="Terminal" copy
moose-cli dev
```
</Python>

<Callout type="info" title="What's happening?">
  The local dev server dynamically configures and updates the infrastructure for
  your application, including a web server for data ingestion and consumption, a
  Redpanda platform for data buffering, and a Clickhouse database for data
  storage and querying.
</Callout>

### Inspect Infrastructure

Check that the infrastructure is setup according to the default starter code in your project by running:

<TypeScript>
```bash filename="Terminal" copy 
npx moose-cli ls 
```
</TypeScript>

<Python>
```bash filename="Terminal" copy 
moose-cli ls 
```
</Python>

You should see the following table in your terminal:

![moose-ls](/moose-ls.png)

</Steps>

## View and Test Your Data Models

<Steps>
### Open Project in IDE

```bash filename="Terminal" copy
code .
```

<Callout type="info" title="VSCode Users: Install Recommended Extensions">
  When you open your project, you'll be prompted to install the
  [SQLTools](https://marketplace.visualstudio.com/items?itemName=mtxr.sqltools)
  and [SQLTools ClickHouse
  Driver](https://marketplace.visualstudio.com/items?itemName=ultram4rine.sqltools-clickhouse-driver)
  extensions. Moose auto-configures these for your local Clickhouse database,
  enabling you to explore and query your data immediately.
</Callout>

<TypeScript>
### Open `models.ts` and Inspect the Data Models
</TypeScript>

<Python>
### Open `models.py` and Inspect the Data Models
</Python>

The file is located inside the `/app/datamodels` directory.

<TypeScript>
```ts filename="/app/datamodels/models.ts" copy
import { Key } from "@514labs/moose-lib";

export interface UserActivity {
  eventId: Key<string>;
  timestamp: string;
  userId: string;
  activity: string;
}

export interface ParsedActivity {
  eventId: Key<string>;
  timestamp: Date;
  userId: string;
  activity: string;
}
```
</TypeScript>

<Python>
```python filename="/datamodels/models.py" copy
from dataclasses import dataclass
import datetime

type Key[T: (str, int)] = T

@dataclass
class UserActivity:
eventId: Key[str]
timestamp: str
userId: str
activity: str

@dataclass
class ParsedActivity:
eventId: Key[str]
timestamp: datetime
userId: str
activity: str

```
</Python>


<Callout type="info">
The file defines `UserActivity` and `ParsedActivity` data models, which structure data for ingestion into your Moose infrastructure.
<br/><br/>Moose automatically created database tables and ingestion points for these models, as seen in the `moose-ls` output.
</Callout>
</Steps>


## Ingest Data

Let's send some sample data to the `UserActivity` data model via the `/ingest/UserActivity/0.0` endpoint that Moose created for us. Run the following command:

<Tabs items={['curl', 'javascript', 'python']}>
  <Tabs.Tab>
  ```bash filename="Terminal" copy
    curl -X POST \
    -H "Content-Type: application/json" \
    -d '{"eventId": "1234567890", "timestamp": "2019-01-01 00:00:01", "userId": "123456", "activity": "click"}' \
    http://localhost:4000/ingest/UserActivity
```

  </Tabs.Tab>
  <Tabs.Tab>
  ```javascript filename="Your Javascript Code" copy
  fetch('http://localhost:4000/ingest/UserActivity', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({
      eventId: '1234567890',
      timestamp: '2019-01-01 00:00:01',
      userId: '123456',
      activity: 'click'
    })
  })
```
  </Tabs.Tab>
  <Tabs.Tab>
  
  ```python filename="Your Python Code" copy
  import requests

requests.post('http://localhost:4000/ingest/UserActivity', json={
'eventId': '1234567890',
'timestamp': '2019-01-01 00:00:01',
'userId': '123456',
'activity': 'click'
})

```
</Tabs.Tab>
</Tabs>

You should see a bunch of messages in the CLI confirming that Moose received the data. Let's double-check that the new data landed in our `UserActivity_0_0` table in our database.

### Query Data

Follow the steps below to get started with querying your data using either the SQLTools VSCode extension or your preferred database explorer tool.

<Tabs items={['Using the SQLTools VSCode Extension', 'Using Your Own Database Explorer']}>
  <Tabs.Tab>
    #### Using the SQLTools VSCode Extension:
    Click the SQLTools database icon in your extensions tab. You should see the Clickhouse icon followed by the connection details for the database running on your local dev server: `panda@localhost:18123/local`.


    ![SQL Tools Setup](/sqltools.png)

    To create and run a new query, click the `New SQL File` icon.

  </Tabs.Tab>
<Tabs.Tab>
  #### Using a Database Explorer:
  The following steps will guide you through configuring your preferred database explorer tool, such as DBeaver or DataGrip, to connect to the Clickhouse database instance that Moose will spin up for you on your local dev server.

- Open your database explorer and navigate to the section for adding a new database connection.
- Enter the connection details as follows:

```text filename="moose.project.toml" copy
[clickhouse config]
  db_name = "local"
  user = "panda"
  password = "pandapass"
  host = "localhost"
  host_port = 18123
```

- Test and save the connection. You should now see the `local` database in your database explorer tool.

<Callout type="info">
  You can find all the infrastructure configuration details in the
  `moose.project.toml` file in your project's root directory
</Callout>

</Tabs.Tab>
</Tabs>

Execute the following query:

```sql filename="DB Explorer" copy
SELECT * FROM local.UserActivity
```

You should see the data you ingested in the `UserActivity` table.

## Next Steps

Congrats! You've successfully set up a Moose project, ingested data, and confirmed that it landed in your database. You're now ready to dive deeper and explore all the exciting capabilities that Moose has to offer. Here are some suggested next steps:

#### Learn Other Moose Primitives

<CTACards columns={2}>
<CTACard 
  title="Process Data with Streaming Functions"
  description="Learn how to process UserActivity data into ParsedActivity data using Streaming Functions" 
  ctaLink="/stream-processing"
  ctaLabel="Learn More" 
  Icon={RectangleEllipsis}
/>

<CTACard
  title="Add a New Data Model"
  description="Take a deeper dive into the Data Models primitive and how to add a new Data Model to your Moose project" 
  ctaLink="/data-models" 
  ctaLabel="Learn More"
  Icon={Square}

/>

</CTACards>
